<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Estación Ambiental</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h1>Datos de la estación</h1>

<table border="1" id="tabla">
  <tr>
    <th>Fecha</th>
    <th>Temperatura</th>
    <th>Humedad</th>
    <th>Presión</th>
  </tr>
</table>

<br>

<canvas id="grafico"></canvas>

<script>

const URL = "https://script.google.com/macros/s/AKfycbzRFCU9xvuNrxeL6GIg06jKVhpBFrddmZ86M-T9jXEabJNdHazOXlA-a9FExJ3CABCF5A/exec";

async function cargarDatos() {

  const response = await fetch(URL);
  const data = await response.json();

  console.log("Datos recibidos:", data);

  const tabla = document.getElementById("tabla");

  // Reset tabla
  tabla.innerHTML = `
    <tr>
      <th>Fecha</th>
      <th>Temperatura</th>
      <th>Humedad</th>
      <th>Presión</th>
    </tr>
  `;

  const labels = [];
  const temp = [];
  const hum = [];
  const pres = [];

  data.forEach(d => {

    const fecha = new Date(d.timestamp).toLocaleString();

    labels.push(fecha);
    temp.push(d.v1);
    hum.push(d.v2);
    pres.push(d.v3);

    tabla.innerHTML += `
      <tr>
        <td>${fecha}</td>
        <td>${d.v1}</td>
        <td>${d.v2}</td>
        <td>${d.v3}</td>
      </tr>
    `;
  });

  new Chart(document.getElementById("grafico"), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Temperatura',
          data: temp
        },
        {
          label: 'Humedad',
          data: hum
        },
        {
          label: 'Presión',
          data: pres
        }
      ]
    }
  });

}

cargarDatos();

</script>

</body>
</html>
